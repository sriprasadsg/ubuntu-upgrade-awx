---
- name: Ubuntu Release Upgrade – Readiness Gate ONLY
  hosts: all
  become: true
  gather_facts: false
  serial: 1

  tasks:
    - name: Check Ubuntu release upgrade readiness
      command: do-release-upgrade -c
      register: release_check
      changed_when: false

    - name: Stop if Ubuntu is not ready
      fail:
        msg: |
          ❌ Ubuntu is NOT ready for release upgrade.
          AWX will not proceed.

          Ubuntu output:
          {{ release_check.stdout }}
      when: "'New release' not in release_check.stdout"

    - name: Ready for upgrade (gate passed)
      debug:
        msg: "Ubuntu reports a new LTS release is available. Safe to upgrade."

